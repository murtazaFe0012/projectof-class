<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/home.css">
    <title>Home</title>
</head>

<body>

    <div class="menu-bar">
        <img src="/images/logo.png" alt="Logo" max-width="50" class="logo">
        <h1>EventHub</h1>
        <div class="button-group">
            <button class="create-event-btn">√âv√©nements</button>
            <button class="create-event-btn">
                Cr√©er un √©v√©nement
            </button>
            <button class="profile-btn" id="profile-btn" aria-label="Profil">
                <img src="/image/profile-picture.png" alt="">
            </button>
        </div>
    </div>

    <div class="filter-bar">
        <p class="filter">
            <button class="jour-nuit" id="toggle-dark" aria-pressed="false">‚òÄÔ∏è</button>
            <i class="fas fa-filter"></i> Filtres:
            <button class="filter-btn">Toutes les cat√©gories</button>
            <button class="filter-btn">Tous les prix</button>
            <button class="filter-btn">Trier par date</button>
        </p>
        <p>
            <%= data.length %> √©v√©nements trouv√©s
        </p>

    </div>

    <div>

    </div>

    <div class="event-container">

        <% data.forEach(data=> { %>
            <div class="event-card" data-slug="<%= data.slug %>" role="button" tabindex="0">
                <div class="card-header">
                    <img src="/<%= data.image_url %>" alt="<%= data.title %>">
                    <span class="event-category">
                        <%= data.category %>
                    </span>
                </div>

                <div class="event-details">
                    <h3>
                        <%= data.title %>
                    </h3>
                    <p>
                        <%= data.description %>
                    </p>

                    <p>
                        <i class="far fa-calendar-alt"></i>
                        <%= data.date %><br>
                            <i class="fas fa-map-marker-alt"></i>
                            <%= data.location %>
                    </p>

                    <div class="event-footer">
                        <span>
                            <%= data.attendance %>/<%= data.capacity %>
                        </span>
                        <span style="font-weight: bold;">$ <%= data.price %></span>
                    </div>
                </div>
            </div>
            <% }) %>
    </div>

    <script>
        //rediriger vers la page profil
        (function () {
            const profileBtn = document.getElementById('profile-btn');
            if (profileBtn) profileBtn.addEventListener('click', function () {
                window.location.href = '/profile';
            });

            //carte cliquable et accessible au clavier
            document.querySelectorAll('.event-card').forEach(function (card) {
                const slug = card.dataset.slug;
                if (!slug) return;
                card.style.cursor = 'pointer';
                card.addEventListener('click', function () {
                    window.location.href = '/e/' + encodeURIComponent(slug);
                });
                card.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        window.location.href = '/e/' + encodeURIComponent(slug);
                    }
                });
            });

            //toggle jour / nuit
            const toggleBtn = document.getElementById('toggle-dark');
            const DARK_KEY = 'darkMode';
            function applyDarkMode(enabled) {
                if (enabled) {
                    document.body.classList.add('dark-mode');
                    if (toggleBtn) toggleBtn.setAttribute('aria-pressed', 'true');
                } else {
                    document.body.classList.remove('dark-mode');
                    if (toggleBtn) toggleBtn.setAttribute('aria-pressed', 'false');
                }
                //mettre √† jour l'emoji du bouton
                if (toggleBtn) toggleBtn.textContent = enabled ? 'üåô' : '‚òÄÔ∏è';
            }
            //√©tat initial depuis localStorage
            const saved = localStorage.getItem(DARK_KEY);
            applyDarkMode(saved === 'true');

            if (toggleBtn) {
                toggleBtn.addEventListener('click', function () {
                    const enabled = document.body.classList.toggle('dark-mode');
                    localStorage.setItem(DARK_KEY, enabled ? 'true' : 'false');
                    toggleBtn.setAttribute('aria-pressed', enabled ? 'true' : 'false');
                    toggleBtn.textContent = enabled ? 'üåô' : '‚òÄÔ∏è';
                });
                toggleBtn.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleBtn.click();
                    }
                });
            }
        })();
    </script>

</body>

</html>